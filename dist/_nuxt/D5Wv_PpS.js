import le from"./ChPTgyWL.js";import{_ as ae}from"./MBIbk9GV.js";import{_ as ce,r as k,o as N,k as pe,N as ue,x as a,y as l,z as u,I as d,J as m,R as z,K as X,O as S,M as P,S as $,A as h,B as de,C as fe,a2 as me,L as E,T as b,D as he}from"./74hHYSrs.js";import{a as ge}from"./DoheFbJ1.js";const ve=["onMousedown"],ye={key:0,class:"absolute -top-5 left-0 px-1 text-xs text-white bg-blue-600"},we={class:"absolute left-1/2 -top-10 -translate-x-1/2 text-xs text-red-500"},ze={class:"absolute -left-6 top-1/2 -translate-y-1/2 text-xs text-red-500"},_e={class:"absolute -right-6 top-1/2 -translate-y-1/2 text-xs text-red-500"},ke={class:"absolute left-1/2 -bottom-5 -translate-x-1/2 text-xs text-red-500"},Ee=["onMousedown"],xe=["onMousedown"],Me=["src"],Ce=["src"],Se={__name:"Canvas",props:{modelValue:Array},setup(q){const s=ge(),K=q,g=k(null),A=["h1","h2","h3","h4","h6","p","a","span"],V=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],R=k(0),T=k(0);let v="",_={x:0,y:0},y=-1;const x=k({});N(()=>{new ResizeObserver(()=>{R.value=g.value?.offsetWidth,T.value=g.value?.offsetHeight}).observe(g.value)});function W(o,e){e&&(x.value[o]=e)}function j(){s.boxes.forEach(o=>o.isSelected=!1),y=-1,s.selectedElement=null,s.updateProperties()}function F(o,e){s.boxes.forEach((r,n)=>r.isSelected=n===o),y=o,H(o,e),s.selectedElement=s.boxes[o].id,s.selectedElementType=s.boxes[o].type,s.activeTab="properties",s.updateProperties(),console.log("element type",s.selectedElementType),["h1","p"].includes(s.boxes[o].type)&&b(()=>{const r=x.value[s.boxes[o].id];r&&r.focus()})}function w(o){if(o.key==="Delete"&&s.selectedElement){const e=s.boxes.findIndex(r=>r.id===s.selectedElement);e!==-1&&(s.boxes.splice(e,1),s.selectedElement=null)}}N(()=>{document.addEventListener("keydown",w)});function H(o,e){const r=s.boxes[o];_.x=e.clientX-r.position.left,_.y=e.clientY-r.position.top,r.isDragging=!0,document.addEventListener("mousemove",L),document.addEventListener("mouseup",M)}function L(o){const e=s.boxes[y],r=g.value.getBoundingClientRect();let n=o.clientX-_.x,t=o.clientY-_.y;n=Math.max(0,Math.min(r.width-e.properties.size.width,n)),t=Math.max(0,Math.min(r.height-e.properties.size.height,t)),e.position.left=n,e.position.top=t,s.currentProperties.x=n,s.currentProperties.y=t,s.updateProperties(s.currentProperties)}function J(o,e){y=o,v=e,document.addEventListener("mousemove",D),document.addEventListener("mouseup",M)}function D(o){const e=s.boxes[y],r=40,n=o.movementX,t=o.movementY;v.includes("right")&&(e.properties.size.width=Math.max(r,e.properties.size.width+n)),v.includes("left")&&(e.properties.size.width=Math.max(r,e.properties.size.width-n),e.position.left+=n),v.includes("bottom")&&(e.properties.size.height=Math.max(r,e.properties.size.height+t)),v.includes("top")&&(e.properties.size.height=Math.max(r,e.properties.size.height-t),e.position.top+=t),s.currentProperties.size={...e.properties.size},s.currentProperties.x=e.position.left,s.currentProperties.y=e.position.top,s.updateProperties(s.currentProperties)}function Q(o,e){const r=s.boxes[o],n=r.position.left+r.properties.size.width/2,t=r.position.top+r.properties.size.height/2,c=e.clientX,i=e.clientY,p=c-n,C=i-t,oe=Math.atan2(C,p)*(360/Math.PI),se=r.properties.rotation;function B(Y){const re=Y.clientX-n,ne=Y.clientY-t,ie=(Math.atan2(ne,re)*(360/Math.PI)-oe)*12;r.properties.rotation=(se+ie+360)%360,s.currentProperties.rotation=Math.floor(r.properties.rotation),s.updateProperties(s.currentProperties)}function O(){document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",O)}document.addEventListener("mousemove",B),document.addEventListener("mouseup",O)}function M(){s.boxes.forEach(o=>o.isDragging=!1),document.removeEventListener("mousemove",L),document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",M)}function G(o){const e=window.getSelection();if(e&&e.rangeCount>0){const r=e.getRangeAt(0);s.cursorPosition={node:r.startContainer,offset:r.startOffset}}}function U(o,e){const r=e.target,n=window.getSelection();let t=0,c=null;if(n&&n.rangeCount>0){const p=n.getRangeAt(0);c=p.startContainer,t=p.startOffset}const i=r.innerText;s.updateElementText(o.id,i),s.currentProperties.text=i,s.updateProperties(s.currentProperties),c&&t!==null&&b(()=>{const p=document.createRange();try{p.setStart(c,t),p.collapse(!0),n.removeAllRanges(),n.addRange(p)}catch(C){console.warn("Failed to restore cursor position:",C)}})}function I(o){console.error("Image failed to load:",o.target.src)}const f=pe(()=>s.boxes.find(o=>o.isSelected));function Z(o){const e=Math.max(12,Math.min(48,o.type==="p"?o.properties.size.height*.2:o.properties.size.height*.4));return{fontSize:o.properties.fontSize==="Auto"||!o.properties.fontSize?e+"px":o.properties.fontSize+"px",fontFamily:o.properties.font||"poppins, sans-serif",fontWeight:o.properties.fontWeight||"normal",fontStyle:o.properties.fontStyle||"normal",textDecoration:o.properties.textDecoration||"none",textTransform:o.properties.textTransform||"none",color:o.properties.color||"black",direction:o.properties.direction||"ltr"}}function ee(o){let e="justify-center";return o.properties.horizontalAlign==="left"&&(e="justify-start"),o.properties.horizontalAlign==="center"&&(e="justify-center"),o.properties.horizontalAlign==="right"&&(e="justify-end"),[e]}function te(o){let e="items-center";return o.properties.verticalAlign==="top"&&(e="items-start"),o.properties.verticalAlign==="middle"&&(e="items-center"),o.properties.verticalAlign==="bottom"&&(e="items-end"),[e]}return ue(()=>s.selectedElement,o=>{if(o){const e=s.boxes.find(r=>r.id===o);e&&["h1","p"].includes(e.type)&&b(()=>{const r=x.value[o];if(r){r.focus();const n=document.createRange(),t=window.getSelection();n.selectNodeContents(r),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}})}}),(o,e)=>{const r=le,n=ae;return l(),a("div",null,[u("div",{ref_key:"canvas",ref:g,class:"absolute w-full h-full bg-white select-none",style:z({background:K.modelValue===E(s).frontBoxes?E(s).frontBackground||"white":E(s).backBackground||"white"}),onMousedown:j},[f.value&&f.value.isDragging?(l(),a(m,{key:0},[u("div",{class:"absolute top-0 bottom-0 w-px bg-blue-500 z-0",style:z({left:f.value.position.left+f.value.properties.size.width/2+"px"})},null,4),u("div",{class:"absolute left-0 right-0 h-px bg-blue-500 z-0",style:z({top:f.value.position.top+f.value.properties.size.height/2+"px"})},null,4)],64)):d("",!0),(l(!0),a(m,null,X(E(s).boxes,(t,c)=>(l(),a(m,{key:t.id},[t.visible?(l(),a("div",{key:0,class:P(["absolute border group border-blue-500",{"border-2 border-blue-500":t.isSelected,"border border-transparent":!t.isSelected}]),style:z({top:t.position.top+"px",left:t.position.left+"px",width:t.properties.size.width+"px",height:t.properties.size.height+"px",transform:`rotate(${t.properties.rotation}deg)`,transformOrigin:"center center",backgroundColor:t.properties.fillTransparency?"transparent":t.properties.fillColor||"#ffffff",border:t.properties.strokeWidth>0?`${t.properties.strokeWidth}px solid ${t.properties.strokeColor}`:"none",zIndex:t.zIndex||0}),onMousedown:S(i=>F(c,i),["stop"]),onKeydown:e[3]||(e[3]=i=>w(i))},[t.isSelected?(l(),a(m,{key:0},[t.label?(l(),a("div",ye,h(t.label),1)):d("",!0),t.isDragging?(l(),a(m,{key:1},[u("div",we," Y: "+h(Math.round(t.position.top)),1),u("div",ze,h(Math.round(t.position.left+t.properties.size.width/2)),1),u("div",_e,h(Math.round(R.value-t.position.left-t.properties.size.width/2)),1),u("div",ke,h(Math.round(T.value-t.position.top-t.properties.size.height/2)),1)],64)):d("",!0),u("div",{class:"rotate-icon",onMousedown:S(i=>Q(c,i),["stop","prevent"])},[de(r,{name:"line-md:rotate-270",class:"text-blue-600"})],40,Ee),(l(),a(m,null,X(V,i=>u("div",{key:i,class:P(["handle",i]),onMousedown:S(p=>J(c,i),["stop","prevent"])},null,42,xe)),64))],64)):d("",!0),A.find(i=>A.includes(t.type))?(l(),$(me(t.type),{key:1,contenteditable:"",class:P(["focus:border focus:outline-none focus:border-blue-500 cursor-move leading-tight w-full h-full flex",[te(t),ee(t)]]),style:z(Z(t)),ref_for:!0,ref:i=>W(t.id,i),onInput:i=>U(t,i),onClick:e[0]||(e[0]=i=>G())},{default:fe(()=>[he(h(t.text),1)]),_:2},1064,["class","style","onInput"])):d("",!0),t.type==="img"?(l(),a("img",{key:2,src:t.properties.src.src,class:"w-full h-full object-contain cursor-pointer select-none",onKeydown:e[1]||(e[1]=i=>w(i)),onError:I},null,40,Me)):d("",!0),t.type==="background"?(l(),a("img",{key:3,src:t.properties.src.src,class:"h-full w-screen bg-cover bg-center cursor-pointer select-none",onKeydown:e[2]||(e[2]=i=>w(i)),onError:I},null,40,Ce)):d("",!0),t.type==="qrcode"?(l(),$(n,{key:4,value:t.properties.qrcode.value,variant:t.properties.qrcode.variant,radius:t.properties.qrcode.radius,blackColor:t.properties.qrcode.blackColor,whiteColor:t.properties.qrcode.whiteColor,onKeydown:i=>w(c)},null,8,["value","variant","radius","blackColor","whiteColor","onKeydown"])):d("",!0)],46,ve)):d("",!0)],64))),128))],36)])}}},Le=ce(Se,[["__scopeId","data-v-9e2de7cb"]]);export{Le as _};
//# sourceMappingURL=D5Wv_PpS.js.map
