import ce from"./CdApalCs.js";import{_ as ue}from"./CogW3G87.js";import{_ as pe}from"./Cq_wP-5r.js";import{_ as fe}from"./CRWWbfYB.js";import{_ as ge,a0 as ye,r as i,k as q,N as I,o as ve,x as me,z as c,B as z,S as R,I as B,L as r,M as E,A as xe,O as he,R as be,y as b,T as we}from"./BrzRvvIN.js";import{i as $}from"./BJ_jGCBy.js";import{u as ke}from"./Dsa2KQgO.js";import"./B7XYhvKA.js";const Se={class:"flex h-screen bg-gray-100 overflow-hidden"},_e={class:"flex-1 flex flex-col items-center p-4"},Te={class:"flex flex-col items-center w-full mb-4"},Ce={class:"mb-4 max-w-xs w-full"},Ae={class:"flex border border-gray-300 rounded-md overflow-hidden"},De=["disabled"],Ie=["disabled"],ze={class:"flex justify-end space-x-2 w-full"},Re={class:"px-2 py-1 bg-gray-200 rounded text-sm"},Be={class:"flex-1 w-full flex justify-center items-start overflow-auto"},Ee={class:"card w-full h-full"},Pe={class:"front border border-gray-300 w-full h-full absolute top-0 left-0"},Ve={class:"back border border-gray-300 w-full h-full absolute top-0 left-0"},$e={__name:"page-builder",props:{selectedElementId:{type:[String,Number],default:null}},setup(Me){const g=ke(),{dropzone:w}=ye(g),k=i([]),S=i([]),u=i("front");i("design");const _=i(100),T=i(!1),h=i(!1);i(null);const P=i({}),N=i(null),O=i(null),C=i(!1),A=i(!1),G=q(()=>_.value/100),M=t=>{h.value||u.value===t||(h.value=!0,u.value=t,setTimeout(()=>{h.value=!1},600))},L=t=>{_.value=Math.max(50,Math.min(200,_.value+t))},W=()=>{T.value=!T.value},X=t=>{};function Y(t){t.preventDefault();const o=w.value.getBoundingClientRect(),l=t.clientX,n=t.clientY;N.value=l-o.left,O.value=n-o.top}const H=({item:t,x:o,y:l})=>{const n=w.value.getBoundingClientRect(),d=o-n.left,x=l-n.top;P.value={item:t,side:u.value,position:{top:x,left:d},properties:{y:x,x:d}},g.currentProperties({y:x,x:d})};function j(t){k.value.push({id:Date.now(),text:t,type:"img",label:"IMG Label",position:{top:100,left:100},properties:{x:100,y:100,rotation:0,size:{width:250,height:150}},isSelected:!1,isDragging:!1,direction:"ltr"}),C.value=!1}function J(t){S.value.push({id:Date.now(),text:t,type:"img",label:"IMG Label",position:{top:100,left:100},properties:{x:100,y:100,rotation:0,size:{width:250,height:150}},isSelected:!1,isDragging:!1,direction:"ltr"}),A.value=!1}const F=i(null);i({width:210,height:297});const s=i([]),a=i(null),V=i(null),y=i([]),v=i("both sides"),e=g.currentProperties;I(()=>[u.value,k.value,S.value],([t,o,l])=>{const n=t==="front"?o:l;if(!n||!Array.isArray(n)){console.warn("Invalid canvas data:",n),s.value=[];return}s.value=[...n]},{deep:!0});const U=t=>{a.value=t},m=q(()=>{if(a.value===null)return null;const t=s.value.find(o=>o.id===a.value);return console.log("Selected Element Type:",t.type),t?t.type:null}),K=t=>{const o=document.querySelector(`[data-element-id="${t.id}"]`);o&&$(o).draggable({enabled:!t.properties.lock,inertia:!0,modifiers:[$.modifiers.restrictRect({restriction:F.value,endOnly:!0})],onmove:l=>{if(t.properties.lock)return;const n=s.value.findIndex(d=>d.id===t.id);n!==-1&&(s[n].properties.x+=l.dx,s[n].properties.y+=l.dy,g.updateProperties())}}).resizable({enabled:!t.properties.lock,edges:{left:!0,right:!0,bottom:!0,top:!0},modifiers:[$.modifiers.restrictSize({min:{width:10,height:10}})],onmove:l=>{if(t.properties.lock)return;const n=s.value.findIndex(d=>d.id===t.id);n!==-1&&(s[n].properties.width=l.rect.width,s[n].properties.height=l.rect.height,s[n].properties.x+=l.deltaRect.left,s[n].properties.y+=l.deltaRect.top,g.updateProperties())}}).on("tap",()=>Q(t.id))},Q=t=>{console.log("Selecting element:",t),a.value=t,V.value=y.value.findIndex(o=>o.id===t),g.updateProperties()},Z=t=>{console.log("Selecting layer:",t),V.value=t,a.value=y.value[t].id,g.updateProperties()},D=()=>{if(a.value===null)return;const t=s.value.findIndex(l=>l.id===a.value);if(t===-1)return;const o=s.value[t];o.type==="h1"?o.properties={...o.properties,x:e.x,y:e.y,width:e.w,height:e.h,rotation:e.r,font:e.font,fontStyle:e.fontStyle,fontSize:e.fontSize,fillColor:e.fillColor,fillTransparency:e.fillTransparency,text:e.text,textDecoration:e.textDecoration,color:e.color,textAlign:e.textAlign,verticalAlign:e.verticalAlign,textTransform:e.textTransform}:o.type==="image"||o.type==="eventlogo"||o.type==="useravatar"?o.properties={...o.properties,x:e.x,y:e.y,width:e.w,height:e.h,rotation:e.r,src:e.src,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,associatedData:e.associatedData}:o.type==="qrcode"?o.properties={...o.properties,x:e.x,y:e.y,width:e.w,height:e.h,rotation:e.r,content:e.content,size:e.size}:o.properties={...o.properties,x:e.x,y:e.y,width:e.w,height:e.h,rotation:e.r}},ee=t=>{y.value[t].visible=!y.value[t].visible;const o=s.value.findIndex(l=>l.id===y.value[t].id);o!==-1&&(s[o].properties.lock=!y.value[t].visible,g.updateProperties())},te=t=>{if(a.value===null)return;const o=s.value.find(d=>d.id===a.value);if(!o)return;const l=w.value.getBoundingClientRect(),n=e.w||o.properties.width;switch(t){case"left":e.x=0;break;case"center":e.x=(l.width-n)/2;break;case"right":e.x=l.width-n;break}D()},oe=t=>{if(a.value===null)return;const o=s.value.find(d=>d.id===a.value);if(!o)return;const l=F.value.getBoundingClientRect(),n=e.h||o.properties.height;switch(t){case"top":e.y=0;break;case"middle":e.y=(l.height-n)/2;break;case"bottom":e.y=l.height-n;break}D()},le=t=>{if(a.value===null)return;const o=s.value.find(l=>l.id===a.value);!o||o.type!=="text"||(t==="bold"?e.fontStyle=e.fontStyle==="Bold"?"Regular":"Bold":t==="italic"?e.fontStyle=e.fontStyle==="Italic"?"Regular":"Italic":t==="underline"&&(e.textDecoration=e.textDecoration==="underline"?"none":"underline"),f())},f=(t=null)=>{if(a.value===null)return;const o=s.value.find(n=>n.id===a.value);if(!o||o.type!=="text")return;t&&(e={...e,...t});const l=document.querySelector(`[data-element-id="${o.id}"] div[contenteditable]`);if(l&&(l.style.fontFamily=e.font,l.style.fontSize=`${e.fontSize}px`,l.style.fontWeight=e.fontStyle==="Bold"?"bold":"normal",l.style.fontStyle=e.fontStyle==="Italic"?"italic":"normal",l.style.color=e.color,l.style.backgroundColor=e.fillTransparency?"transparent":e.fillColor,l.style.textDecoration=e.textDecoration,l.style.textAlign=v.value==="right side only"?"right":e.textAlign,l.style.verticalAlign=e.verticalAlign,l.style.textTransform=e.textTransform,l.style.direction=v.value==="right side only"?"rtl":"ltr",l.setAttribute("dir",v.value==="right side only"?"rtl":"ltr"),l.textContent=e.text||o.properties.exampleText,v.value==="right side only")){const n=document.createRange(),d=window.getSelection();n.selectNodeContents(l),n.collapse(!1),d.removeAllRanges(),d.addRange(n)}D()},ne=()=>{m.value==="text"&&(e.fillColor="rgba(0, 0, 0, 0)",e.fillTransparency=!0,f())},re=t=>{m.value==="text"&&(e.fillColor=t,e.fillTransparency=!1,f(),we(()=>{const o=document.querySelector(`[data-element-id="${a.value}"] div[contenteditable]`);o&&(o.style.backgroundColor=e.fillColor)}))},se=t=>{m.value==="text"&&(e.textAlign=t,f())},ie=t=>{m.value==="text"&&(e.verticalAlign=t,f())},ae=t=>{m.value==="text"&&(e.textTransform=t,f())},de=t=>{v.value=t,f()};return I(a,()=>{g.updateProperties(),a.value&&f()}),I(e,()=>D(),{deep:!0}),ve(()=>{s.value.forEach(K)}),I(v,()=>{f()}),(t,o)=>{const l=ce,n=ue,d=pe,x=fe;return b(),me("div",Se,[c("div",_e,[c("div",Te,[c("div",Ce,[c("div",Ae,[c("button",{class:E(["flex-1 px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400",{"bg-blue-500 text-white":r(u)==="front","bg-gray-200 text-gray-700 hover:bg-gray-300":r(u)!=="front","rounded-l-md":!0}]),onClick:o[0]||(o[0]=p=>M("front")),disabled:r(h)}," Front Side ",10,De),c("button",{class:E(["flex-1 px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400",{"bg-blue-500 text-white":r(u)==="back","bg-gray-200 text-gray-700 hover:bg-gray-300":r(u)!=="back","rounded-r-md":!0}]),onClick:o[1]||(o[1]=p=>M("back")),disabled:r(h)}," Back Side ",10,Ie)])]),c("div",ze,[c("button",{class:"p-1 bg-gray-200 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400",onClick:o[2]||(o[2]=p=>L(-10))},[z(l,{name:"mdi:minus",class:"w-4 h-4"})]),c("span",Re,xe(r(_))+"%",1),c("button",{class:"p-1 bg-gray-200 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400",onClick:o[3]||(o[3]=p=>L(10))},[z(l,{name:"mdi:plus",class:"w-4 h-4"})]),c("button",{class:E(["p-1 bg-gray-200 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400",{"bg-blue-500 text-white":r(T)}]),onClick:W},[z(l,{name:"mdi:grid",class:"w-4 h-4"})],2)])]),c("div",Be,[c("div",{ref_key:"dropzone",ref:w,class:E(["design-page w-[400px] sm:w-[500px] h-[500px] sm:h-[600px] bg-white",{"grid-overlay":r(T),flipped:r(u)==="back"}]),style:be({transform:`scale(${r(G)})`,transformOrigin:"center top"}),onDragover:o[8]||(o[8]=he(()=>{},["prevent"])),onDrop:Y},[c("div",Ee,[c("div",Pe,[r(u)==="front"?(b(),R(n,{key:0,modelValue:r(k),sendElement:r(P),onAddToFrontCanvas:o[4]||(o[4]=p=>r(k).push(p)),onRequestFrontImage:o[5]||(o[5]=p=>C.value=!0),onSendSelectedElement:U},null,8,["modelValue","sendElement"])):B("",!0)]),c("div",Ve,[r(u)==="back"?(b(),R(n,{key:0,modelValue:r(S),sendElement:r(P),onAddToBackCanvas:o[6]||(o[6]=p=>r(S).push(p)),onRequestBackImage:o[7]||(o[7]=p=>A.value=!0),onSendSelectedElement:U},null,8,["modelValue","sendElement"])):B("",!0)])])],38)])]),z(d,{"selected-element":r(a),"selected-element-type":r(m),layers:r(y),"selected-layer":r(V),"current-properties":r(e),"display-option":r(v),onDragStart:X,onDragEnd:H,onAlignHorizontal:te,onAlignVertical:oe,onUpdateProperties:t.updateProperties,onApplyTextStyle:f,onMakeTransparent:ne,onApplyColor:re,onApplyTextAlign:se,onApplyVerticalAlign:ie,onApplyTextTransform:ae,onToggleTextStyle:le,onApplyDisplayOption:de,onSelectLayer:Z,onToggleLayerVisibility:ee},null,8,["selected-element","selected-element-type","layers","selected-layer","current-properties","display-option","onUpdateProperties"]),r(C)?(b(),R(x,{key:0,side:"front",onUploaded:j,onClose:o[9]||(o[9]=p=>C.value=!1)})):B("",!0),r(A)?(b(),R(x,{key:1,side:"back",onUploaded:J,onClose:o[10]||(o[10]=p=>A.value=!1)})):B("",!0)])}}},Xe=ge($e,[["__scopeId","data-v-ed50f9ab"]]);export{Xe as default};
//# sourceMappingURL=CRphIVbt.js.map
